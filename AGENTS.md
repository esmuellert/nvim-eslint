# AGENTS.md - AI Agent Context for nvim-eslint

## Project Overview

`nvim-eslint` is a Neovim language server plugin that integrates ESLint functionality within Neovim. This plugin acts as a **bridge** between two critical components:

1. **Neovim's built-in language client** - The native LSP client implementation in Neovim
2. **[microsoft/vscode-eslint](https://github.com/microsoft/vscode-eslint)** - Microsoft VSCode's ESLint language server

### Core Architecture

The plugin enables ESLint linting in Neovim by:
- Using Neovim's native LSP client API
- Connecting to the vscode-eslint language server packaged in the `vscode-eslint` folder
- Providing optimized default configurations and settings
- Supporting complex scenarios like monorepos and ESLint flat configs

## Sources of Truth

When developing or maintaining this plugin, **always refer to these authoritative sources**:

### 1. Neovim LSP API
- **Official API Documentation**: [Neovim LSP Client API](https://neovim.io/doc/user/lsp.html)
- **Source Code**: [neovim/neovim](https://github.com/neovim/neovim)
- The plugin uses Neovim's native LSP client, so all client-side behavior must conform to Neovim's API

### 2. vscode-eslint Language Server
- **Repository**: [microsoft/vscode-eslint](https://github.com/microsoft/vscode-eslint)
- **Documentation**: Server settings, configuration options, and protocol behavior
- **Source Code**: Especially `server/src/eslint.ts` and `server/src/eslintServer.ts`
- **Client Code**: `client/src/client.ts` for understanding expected client behavior
- The language server is the final reference for all ESLint-related functionality

### 3. README.md (This Repository)
- **The specification of the plugin** - explains how it works and what configurations it supports
- Must ensure that new changes don't break existing designs documented in README.md
- Contains critical configuration examples and debugging instructions

## Key Directories

### `vscode-eslint/`
- Contains the **built vscode-eslint language server**
- Generated by running the build script in the repository root
- This is the actual language server binary that Neovim connects to
- **Do not manually edit** - rebuild using the build script if updates are needed
- Explained in detail in README.md

### `lua/`
- **Main plugin implementation**
- Implements the Neovim LSP client configuration
- Contains all settings, handlers, and utility functions
- Must follow **Neovim plugin development best practices**:
  - Use Neovim's modern Lua API
  - Proper error handling with `vim.notify`
  - Leverage `vim.fs`, `vim.lsp`, and `vim.api` modules
  - Follow community conventions for plugin structure

### `tests/`
- Contains **end-to-end tests** that run the plugin with Neovim in headless mode
- Uses real repositories to ensure the plugin functions correctly
- Tests compare nvim-eslint output with ESLint CLI output for parity

#### Testing Requirements
- **Package Manager**: Always use `pnpm` for external test repositories
- **Neovim Version**: Must be no older than the latest released version from [neovim/neovim releases](https://github.com/neovim/neovim/releases)
- **Installation**: If Neovim is not available in your environment, install it before running tests
- **CI**: Tests run in GitHub Actions using headless Neovim

## Development Guidelines

### Making Changes

1. **Understand Both Sides**
   - Changes often require understanding both Neovim LSP client behavior AND vscode-eslint server expectations
   - Check Neovim API docs for client-side changes
   - Check vscode-eslint source code for server-side behavior

2. **Configuration Changes**
   - All settings mirror vscode-eslint server parameters
   - Reference vscode-eslint settings documentation
   - Dynamic settings use Lua functions that receive buffer numbers

3. **Testing Changes**
   - Run end-to-end tests in `tests/` directory
   - Tests ensure parity between nvim-eslint and ESLint CLI
   - Follow instructions in test documentation

## Additional Resources

- **Project README**: Comprehensive setup and configuration guide
- **Neovim LSP Help**: `:help lsp` in Neovim
- **vscode-eslint Docs**: [GitHub Repository](https://github.com/microsoft/vscode-eslint)
- **ESLint Documentation**: [eslint.org](https://eslint.org/)
- **LSP Specification**: [Language Server Protocol](https://microsoft.github.io/language-server-protocol/)

---

This document provides context for AI agents working on nvim-eslint. Always prioritize the sources of truth (Neovim API and vscode-eslint) when making decisions.
